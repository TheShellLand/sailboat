#!/usr/bin/env python
# -*- coding: utf8 -*-

import re, chardet, json, string
from pprint import pprint


def strings(blob, min=4):
    result = ""
    for c in blob:
        if c in string.printable:
            result += c
            continue
        if len(result) >= min:
            yield result
        result = ""

BLOCK = b'\xebH\x90ddd\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00' \
        b'\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00' \
        b'\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x03\x02\xff\x00\x00 ' \
        b'\x01\x00\x00\x00\x00\x02\xfa\x90\x90\xf6\xc2\x80u\x02\xb2\x80\xeaY|\x00\x001\xc0\x8e\xd8\x8e\xd0\xbc\x00 ' \
        b'\xfb\xa0@|<\xfft\x02\x88\xc2R\xbe\x7f}\xe84\x01\xf6\xc2\x80tT\xb4A\xbb\xaaU\xcd\x13ZRrI\x81\xfbU\xaauC\xa0A' \
        b'|\x84\xc0u\x05\x83\xe1\x01t7f\x8bL\x10\xbe\x05|\xc6D\xff\x01f\x8b\x1eD|\xc7\x04\x10\x00\xc7D\x02\x01\x00f' \
        b'\x89\\\x08\xc7D\x06\x00pf1\xc0\x89D\x04f\x89D\x0c\xb4B\xcd\x13r\x05\xbb\x00p\xeb}\xb4\x08\xcd\x13s\n\xf6' \
        b'\xc2\x80\x0f\x84\xea\x00\xe9\x8d\x00\xbe\x05|\xc6D\xff\x00f1\xc0\x88\xf0@f\x89D\x041\xd2\x88\xca\xc1\xe2' \
        b'\x02\x88\xe8\x88\xf4@\x89D\x081\xc0\x88\xd0\xc0\xe8\x02f\x89\x04f\xa1D|f1\xd2f\xf74\x88T\nf1\xd2f\xf7t\x04' \
        b'\x88T\x0b\x89D\x0c;D\x08}<\x8aT\r\xc0\xe2\x06\x8aL\n\xfe\xc1\x08\xd1\x8al\x0cZ\x8at\x0b\xbb\x00p\x8e\xc31' \
        b'\xdb\xb8\x01\x02\xcd\x13r*\x8c\xc3\x8e\x06H|`\x1e\xb9\x00\x01\x8e\xdb1\xf61\xff\xfc\xf3\xa5\x1fa\xff&B|\xbe' \
        b'\x85}\xe8@\x00\xeb\x0e\xbe\x8a}\xe88\x00\xeb\x06\xbe\x94}\xe80\x00\xbe\x99}\xe8*\x00\xeb\xfeGRUB ' \
        b'\x00Geom\x00Hard Disk\x00Read\x00 Error\x00\xbb\x01\x00\xb4\x0e\xcd\x10\xac<\x00u\xf4\xc3\x00\x00\x00\x00' \
        b'\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x80\x01\x01\x00\x0c\xfe\x7f\xe5?\x00\x00\x00\'"w\x00' \
        b'\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00' \
        b'\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00U\xaaRV\xbe\x03' \
        b'!\xe8*\x01^\xbf\xf8!f\x8b-\x83}\x04\x00\x0f\x84\xca\x00\x80|\xff\x00t>f\x8b\x1df1\xc0\xb0\x7f9E\x04\x7f\x03' \
        b'\x8bE\x04)E\x04f\x01\x05\xc7\x04\x10\x00\x89D\x02f\x89\\\x08\xc7D\x06\x00pPf1\xc0\x89D\x04f\x89D\x0c\xb4B' \
        b'\xcd\x13\x0f\x82\x9f\x00\xbb\x00p\xebVf\x8b\x05f1\xd2f\xf74\x88T\nf1\xd2f\xf7t\x04\x88T\x0b\x89D\x0c;D\x08' \
        b'}t\x8b\x04*D\n9E\x04\x7f\x03\x8bE\x04)E\x04f\x01\x05\x8aT\r\xc0\xe2\x06\x8aL\n\xfe\xc1\x08\xd1\x8al\x0cZR' \
        b'\x8at\x0bP\xbb\x00p\x8e\xc31\xdb\xb4\x02\xcd\x13rF\x8c\xc3\x8eE\x06X\xc1\xe0\x05\x01E\x06`\x1e\xc1\xe0\x04' \
        b'\x89\xc11\xff1\xf6\x8e\xdb\xfc\xf3\xa4\x1f\xbe\x14!\xe8`\x00a\x83}\x04\x00\x0f\x85<\xff\x83\xef\x08\xe9' \
        b'.\xff\xbe\x16!\xe8K\x00Z\xea\x00"\x00\x00\xbe\x19!\xe8?\x00\xeb\x06\xbe\x1e!\xe87\x00\xbe#!\xe81\x00\xeb' \
        b'\xfeLoading stage1.5\x00.\x00\r\n\x00Geom\x00Read\x00 ' \
        b'Error\x00\xbb\x01\x00\xb4\x0e\xcd\x10F\x8a\x04<\x00u\xf2\xc3\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00' \
        b'\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00' \
        b'\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00' \
        b'\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00' \
        b'\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00' \
        b'\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00' \
        b'\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00' \
        b'\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x02\x00' \
        b'\x00\x00\x0f\x00 \x02\xeap"\x00\x00\x00\x03\x02\xff\xff\xff\x00\x00\x00\x00\x00\x03\x000.97\x00\xff\xff\x00' \
        b'\xff/boot/grub/stage2 /boot/grub/menu.lst\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00' \
        b'\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00' \
        b'\x00\x00\x00\x00\x00\x00\xfa1\xc0\x8e\xd8\x8e\xd0\x8e\xc0gf\x89-\xfc$\x00\x00f\xbd\xf0\x1f\x00\x00f\x89\xec' \
        b'\xfbg\x88\x15\xf8$\x00\x00\xcd\x13f\xe8a\x00\x00\x00\xbf0?\x00\x00\xb9\xdc?\x00\x00)\xf90\xc0\xfc\xf3\xaa' \
        b'\xe8\x98\x02\x00\x00\xe8\x8c\x00\x00\x00\xf4\xe9\xfa\xff\xff\xff\x8bD$\x08\xa3\x00%\x00\x00\x89\xc3f\x8bD$' \
        b'\x04f\xa3\x04%\x00\x00\xc1\xe0\x04\x01\xc3\xa1\xd8?\x00\x00\x89\x83\x08\x00\x00\x00\x8a\x15 ' \
        b'?\x00\x00\x8bL$\x0c\xe8Q\x00\x00\x00f\x89\xcdgf\xff-\x00%\x00\x00\xfagf\x0f\x01\x15@%\x00\x00\x0f ' \
        b'\xc0f\x83\xc8\x01\x0f"\xc0f\xea\x17#\x00\x00\x08\x00f\xb8\x10\x00\x8e\xd8\x8e\xc0\x8e\xe0\x8e\xe8\x8e\xd0' \
        b'\x8b\x04$\xa3\xf0\x1f\x00\x00\xa1\xf4$\x00\x00\x89\xc4\x89\xc5\xa1\xf0\x1f\x00\x00\x89\x04$1\xc0\xc3\x0f' \
        b'\x01\x15@%\x00\x00\x89\xe0\xa3\xf4$\x00\x00\x8b\x04$\xa3\xf0\x1f\x00\x00\xb8\xf0\x1f\x00\x00\x89\xc4\x89' \
        b'\xc5f\xb8 \x00\x8e\xd8\x8e\xc0\x8e\xe0\x8e\xe8\x8e\xd0\xeau#\x00\x00\x18\x00\x0f ' \
        b'\xc0f\x83\xe0\xfe\x0f"\xc0f\xea\x87#\x00\x00\x00\x00f1\xc0\x8e\xd8\x8e\xc0\x8e\xe0\x8e\xe8\x8e\xd0\xfbf' \
        b'\xc3U\x89\xe5VS\x8bE\x10f\x89\xc6f1\xc0\xc1\xe8\x04f\x89\xc1\x8aU\x0cf\x8b]\x08\xe8\x8a\xff\xff\xff\x89\xd8' \
        b'\x8e\xd9\xcd\x13\x88\xe21\xc0\x8e\xd8f\xe82\xff\xff\xff\x88\xd0[' \
        b'^]\xc3U\x89\xe5SWV\x8bE\x10\x88\xc5\x8aE\x18\xc0\xe0\x02f\xc1\xe8\x02\x88\xc1\x8au\x14\x8aU\x0cf\x8b] ' \
        b'\x8ae\x08\x8aE\x1cf\x89\xc7\xe8C\xff\xff\xff\x8e\xc3'

OUT = 'ëH\x90ddd\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00' \
      '\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00' \
      '\x00\x00\x00\x00\x00\x00\x00\x03\x02ÿ\x00\x00 ' \
      '\x01\x00\x00\x00\x00\x02ú\x90\x90öÂ\x80u\x02²\x80êY|\x00\x001À\x8eØ\x8eÐ¼\x00 ' \
      'û\xa0@|<ÿt\x02\x88ÂR¾\x7f}è4\x01öÂ\x80tT´A»ªUÍ\x13ZRrI\x81ûUªuC\xa0A|\x84Àu\x05\x83á\x01t7f\x8bL\x10¾\x05|ÆD' \
      'ÿ\x01f\x8b\x1eD|Ç\x04\x10\x00ÇD\x02\x01\x00f\x89\\\x08ÇD\x06\x00pf1À\x89D\x04f\x89D\x0c´BÍ\x13r\x05»\x00p' \
      'ë}´\x08Í\x13s\nöÂ\x80\x0f\x84ê\x00é\x8d\x00¾\x05|ÆDÿ\x00f1À\x88ð@f\x89D\x041Ò\x88ÊÁâ\x02\x88è\x88ô@\x89D\x081' \
      'À\x88ÐÀè\x02f\x89\x04f¡D|f1Òf÷4\x88T\nf1Òf÷t\x04\x88T\x0b\x89D\x0c;D\x08}<\x8aT\rÀâ\x06\x8aL\nþÁ\x08Ñ\x8al' \
      '\x0cZ\x8at\x0b»\x00p\x8eÃ1Û¸\x01\x02Í\x13r*\x8cÃ\x8e\x06H|`\x1e¹\x00\x01\x8eÛ1ö1ÿüó¥\x1faÿ&B|¾\x85}è@\x00ë\x0e' \
      '¾\x8a}è8\x00ë\x06¾\x94}è0\x00¾\x99}è*\x00ëþGRUB \x00Geom\x00Hard Disk\x00Read\x00 ' \
      'Error\x00»\x01\x00´\x0eÍ\x10¬<\x00uôÃ\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x80' \
      '\x01\x01\x00\x0cþ\x7få?\x00\x00\x00\'"w\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00' \
      '\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00' \
      '\x00\x00\x00\x00\x00UªRV¾\x03!è*\x01^¿ø!f\x8b-\x83}\x04\x00\x0f\x84Ê\x00\x80|ÿ\x00t>f\x8b\x1df1À°\x7f9E\x04' \
      '\x7f\x03\x8bE\x04)E\x04f\x01\x05Ç\x04\x10\x00\x89D\x02f\x89\\\x08ÇD\x06\x00pPf1À\x89D\x04f\x89D\x0c´BÍ\x13\x0f' \
      '\x82\x9f\x00»\x00pëVf\x8b\x05f1Òf÷4\x88T\nf1Òf÷t\x04\x88T\x0b\x89D\x0c;D\x08}t\x8b\x04*D\n9E\x04\x7f\x03\x8bE' \
      '\x04)E\x04f\x01\x05\x8aT\rÀâ\x06\x8aL\nþÁ\x08Ñ\x8al\x0cZR\x8at\x0bP»\x00p\x8eÃ1Û´\x02Í\x13rF\x8cÃ\x8eE\x06X' \
      'Áà\x05\x01E\x06`\x1eÁà\x04\x89Á1ÿ1ö\x8eÛüó¤\x1f¾\x14!è`\x00a\x83}\x04\x00\x0f\x85<ÿ\x83ï\x08é.ÿ¾\x16!èK\x00Z' \
      'ê\x00"\x00\x00¾\x19!è?\x00ë\x06¾\x1e!è7\x00¾#!è1\x00ëþLoading stage1.5\x00.\x00\r\n\x00Geom\x00Read\x00 ' \
      'Error\x00»\x01\x00´\x0eÍ\x10F\x8a\x04<\x00uòÃ\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00' \
      '\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00' \
      '\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00' \
      '\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00' \
      '\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00' \
      '\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00' \
      '\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00' \
      '\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x02\x00\x00\x00\x0f\x00 ' \
      '\x02êp"\x00\x00\x00\x03\x02ÿÿÿ\x00\x00\x00\x00\x00\x03\x000.97\x00ÿÿ\x00ÿ/boot/grub/stage2 ' \
      '/boot/grub/menu.lst\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00' \
      '\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00ú1' \
      'À\x8eØ\x8eÐ\x8eÀgf\x89-ü$\x00\x00f½ð\x1f\x00\x00f\x89ìûg\x88\x15ø$\x00\x00Í\x13fèa\x00\x00\x00¿0?\x00\x00' \
      '¹Ü?\x00\x00)ù0Àüóªè\x98\x02\x00\x00è\x8c\x00\x00\x00ôéúÿÿÿ\x8bD$\x08£\x00%\x00\x00\x89Ãf\x8bD$\x04f£\x04%\x00' \
      '\x00Áà\x04\x01Ã¡Ø?\x00\x00\x89\x83\x08\x00\x00\x00\x8a\x15 ' \
      '?\x00\x00\x8bL$\x0cèQ\x00\x00\x00f\x89Ígfÿ-\x00%\x00\x00úgf\x0f\x01\x15@%\x00\x00\x0f ' \
      'Àf\x83È\x01\x0f"Àfê\x17#\x00\x00\x08\x00f¸\x10\x00\x8eØ\x8eÀ\x8eà\x8eè\x8eÐ\x8b\x04$£ð\x1f\x00\x00¡ô$\x00\x00' \
      '\x89Ä\x89Å¡ð\x1f\x00\x00\x89\x04$1ÀÃ\x0f\x01\x15@%\x00\x00\x89à£ô$\x00\x00\x8b\x04$£ð\x1f\x00\x00¸ð\x1f\x00' \
      '\x00\x89Ä\x89Åf¸ \x00\x8eØ\x8eÀ\x8eà\x8eè\x8eÐêu#\x00\x00\x18\x00\x0f ' \
      'Àf\x83àþ\x0f"Àfê\x87#\x00\x00\x00\x00f1À\x8eØ\x8eÀ\x8eà\x8eè\x8eÐûfÃU\x89åVS\x8bE\x10f\x89Æf1ÀÁè\x04f\x89' \
      'Á\x8aU\x0cf\x8b]\x08è\x8aÿÿÿ\x89Ø\x8eÙÍ\x13\x88â1À\x8eØfè2ÿÿÿ\x88Ð[' \
      '^]ÃU\x89åSWV\x8bE\x10\x88Å\x8aE\x18Àà\x02fÁè\x02\x88Á\x8au\x14\x8aU\x0cf\x8b] \x8ae\x08\x8aE\x1cf\x89ÇèCÿÿÿ\x8eÃ'

FDISK_OUT = '''
    root@4d8b8e82-304c-4095-87d9-5912ea02c32a:~/sdc# fdisk -lu usb-release-20151224-20151224T195900Z-gf987f1d-4gb.img

    Disk usb-release-20151224-20151224T195900Z-gf987f1d-4gb.img: 3.7 GiB, 4000000000 bytes, 7812500 sectors
    Units: sectors of 1 * 512 = 512 bytes
    Sector size (logical/physical): 512 bytes / 512 bytes
    I/O size (minimum/optimal): 512 bytes / 512 bytes
    Disklabel type: dos
    Disk identifier: 0x00000000

    Device                                                  Boot Start     End Sectors  Size Id Type
    usb-release-20151224-20151224T195900Z-gf987f1d-4gb.img1 *       63 7807589 7807527  3.7G  c W95 FAT32 (LBA)
            '''

DECODE_CHECK = chardet.detect(BLOCK)

DECODED = BLOCK.decode(DECODE_CHECK['encoding'])

for i in strings(DECODED, 10):
    print('>>> DECODED:', i)

print('>>> FDISK:', FDISK_OUT)
